<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenMark - PDF Viewer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/viewer.css') }}">
    <script src="{{ url_for('static', filename='lib/pdfjs/pdf.min.js') }}"></script>
    {% if customization.primary_color %}
    <style>
        :root {
            --primary-color: {{ customization.primary_color }};
        }
    </style>
    {% endif %}
</head>
<body class="viewer-page">
    <!-- Toolbar -->
    <div class="viewer-toolbar">
        <div class="toolbar-left">
            <a href="/dashboard" class="toolbar-brand">üîñ OpenMark</a>
            <button class="toolbar-btn" id="showSidebar" title="Show Annotations" style="display: none;">‚ñ∂</button>
            <span class="toolbar-separator"></span>
            <span class="document-name" id="documentName">{{ document_id }}</span>
        </div>
        
        <div class="toolbar-center">
            <button class="toolbar-btn" id="prevPage" title="Previous Page">
                ‚óÄ
            </button>
            <span class="page-info">
                <input type="number" id="pageInput" min="1" value="1"> 
                / <span id="totalPages">1</span>
            </span>
            <button class="toolbar-btn" id="nextPage" title="Next Page">
                ‚ñ∂
            </button>
            <span class="toolbar-separator"></span>
            <button class="toolbar-btn" id="zoomOut" title="Zoom Out">‚àí</button>
            <span id="zoomLevel">100%</span>
            <button class="toolbar-btn" id="zoomIn" title="Zoom In">+</button>
        </div>
        
        <div class="toolbar-right">
            <button class="toolbar-btn tool-btn" id="noteTool" title="Add Note" data-tool="note">
                üìù
            </button>
            <button class="toolbar-btn tool-btn" id="highlightTool" title="Highlight" data-tool="highlight">
                üñçÔ∏è
            </button>
            <div class="color-picker" id="colorPicker">
                <button class="color-btn" data-color="#ffff00" style="background: #ffff00" title="Yellow"></button>
                <button class="color-btn" data-color="#90EE90" style="background: #90EE90" title="Green"></button>
                <button class="color-btn" data-color="#FFB6C1" style="background: #FFB6C1" title="Pink"></button>
                <button class="color-btn" data-color="#87CEEB" style="background: #87CEEB" title="Blue"></button>
                <button class="color-btn" data-color="#FFA500" style="background: #FFA500" title="Orange"></button>
            </div>
            <span class="toolbar-separator"></span>
            <button class="toolbar-btn" id="saveBtn" title="Save Annotations">
                üíæ Save
            </button>
        </div>
    </div>
    
    <!-- Main viewer area -->
    <div class="viewer-container">
        <!-- Sidebar for annotations list -->
        <div class="viewer-sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>Annotations</h3>
                <button class="sidebar-toggle" id="toggleSidebar">‚óÄ</button>
            </div>
            <div class="sidebar-content">
                <div id="pagesAccordion" class="pages-accordion">
                    <!-- Pages will be dynamically generated -->
                </div>
            </div>
        </div>
        
        <!-- PDF Canvas Container -->
        <div class="pdf-container" id="pdfContainer">
            <!-- Loading overlay -->
            <div class="loading-overlay" id="loadingOverlay">
                <div class="loading-spinner"></div>
                <div class="loading-text">Loading PDF...</div>
                <div class="loading-progress" id="loadingProgress"></div>
            </div>
            
            <!-- Error overlay -->
            <div class="error-overlay" id="errorOverlay" style="display: none;">
                <div class="error-icon">‚ö†Ô∏è</div>
                <div class="error-title">Failed to load PDF</div>
                <div class="error-message" id="errorMessage">An error occurred while loading the document.</div>
                <button class="btn btn-primary" id="retryLoadBtn">Retry</button>
            </div>
            
            <div class="pdf-page-wrapper" id="pageWrapper">
                <canvas id="pdfCanvas"></canvas>
                <div class="annotations-layer" id="annotationsLayer"></div>
            </div>
        </div>
    </div>
    
    <!-- Note Editor Modal -->
    <div class="modal" id="noteModal" style="display: none;">
        <div class="modal-content note-editor">
            <div class="note-header" id="noteHeader">
                <span>Note</span>
                <button class="close-btn" id="closeNoteModal">√ó</button>
            </div>
            <textarea id="noteContent" placeholder="Enter your note..."></textarea>
            <div class="note-footer">
                <button class="btn btn-danger" id="deleteNote" style="display: none;">Delete</button>
                <button class="btn btn-primary" id="saveNote">Save</button>
            </div>
        </div>
    </div>
    
    <!-- Toast notification -->
    <div class="toast" id="toast" style="display: none;"></div>
    
    <script>
        // Pass data from server to JavaScript
        window.OPENMARK = {
            tempDocumentId: "{{ temp_doc_id }}",
            documentId: "{{ document_id }}",
            {% if dat %}
            dat: "{{ dat }}",
            token: null,
            pdfUrl: "/pdf/{{ temp_doc_id }}?dat={{ dat }}",
            {% else %}
            dat: null,
            token: "{{ token }}",
            pdfUrl: "/pdf/{{ temp_doc_id }}?token={{ token }}",
            {% endif %}
            hideAnnotationsTools: {{ 'true' if hide_annotations_tools else 'false' }},
            hideAnnotations: {{ 'true' if hide_annotations else 'false' }},
            hideLogo: {{ 'true' if hide_logo else 'false' }}
        };
    </script>
    <script src="{{ url_for('static', filename='js/viewer.js') }}"></script>
    {% if customization.script_file %}
    <script src="{{ customization.script_file }}"></script>
    {% endif %}
</body>
</html>
